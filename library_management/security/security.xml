<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Security Groups -->
    <record id="group_library_member" model="res.groups">
        <field name="name">Library Member</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="group_library_librarian" model="res.groups">
        <field name="name">Librarian</field>
        <field name="implied_ids" eval="[(4, ref('group_library_member'))]"/>
    </record>

    <record id="group_library_admin" model="res.groups">
        <field name="name">Library Admin</field>
        <field name="implied_ids" eval="[(4, ref('group_library_librarian'))]"/>
    </record>

    <!-- Record Rules -->
    <!-- Members can only see their own borrowings (if linked to a user) -->
    <record id="library_borrowing_member_rule" model="ir.rule">
        <field name="name">Library Member: See own borrowings</field>
        <field name="model_id" ref="model_library_borrowing"/>
        <field name="domain_force">['|', ('member_id.user_id', '=', False), ('member_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_library_member'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Members can only see their own fines (if linked to a user) -->
    <record id="library_fine_member_rule" model="ir.rule">
        <field name="name">Library Member: See own fines</field>
        <field name="model_id" ref="model_library_fine"/>
        <field name="domain_force">['|', ('member_id.user_id', '=', False), ('member_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_library_member'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Librarians can see all records -->
    <record id="library_borrowing_librarian_rule" model="ir.rule">
        <field name="name">Librarian: See all borrowings</field>
        <field name="model_id" ref="model_library_borrowing"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_library_librarian'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="library_fine_librarian_rule" model="ir.rule">
        <field name="name">Librarian: See all fines</field>
        <field name="model_id" ref="model_library_fine"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_library_librarian'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Admin has full access (handled by access rights) -->
    <record id="library_borrowing_admin_rule" model="ir.rule">
        <field name="name">Admin: Full access to borrowings</field>
        <field name="model_id" ref="model_library_borrowing"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_library_admin'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <record id="library_fine_admin_rule" model="ir.rule">
        <field name="name">Admin: Full access to fines</field>
        <field name="model_id" ref="model_library_fine"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_library_admin'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Configuration Parameters -->
    <record id="config_fine_per_day" model="ir.config_parameter">
        <field name="key">library.fine_per_day</field>
        <field name="value">5.0</field>
    </record>

    <!-- Sequences -->
    <record id="seq_library_borrowing" model="ir.sequence">
        <field name="name">Library Borrowing Sequence</field>
        <field name="code">library.borrowing</field>
        <field name="prefix">BOR</field>
        <field name="padding">5</field>
        <field name="company_id" eval="False"/>
    </record>

    <record id="seq_library_fine" model="ir.sequence">
        <field name="name">Library Fine Sequence</field>
        <field name="code">library.fine</field>
        <field name="prefix">FINE</field>
        <field name="padding">5</field>
        <field name="company_id" eval="False"/>
    </record>
</odoo>